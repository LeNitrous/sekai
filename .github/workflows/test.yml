name: Test
on: push

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
        - name: Checkout
          uses: actions/checkout@v2
          with:
            fetch-depth: 0

        - name: Install .NET 7 STS
          uses: actions/setup-dotnet@v1
          with:
            dotnet-version: "7.0.x"

        - name: Test
          run: dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=lcov /p:CoverletOutput="../results/" /p:MregeWith="../results/coverage.info" --logger trx --results-directory "./tests/results/"

        - name: Upload Results
          uses: actions/upload-artifact@v2
          with:
            name: results
            path: tests/results/

        - name: Upload Coverage
          uses: codecov/codecov-action@v3
          with:
            token: ${{ secrets.CODECOV_TOKEN }}
            files: ./tests/results/coverage.info
